<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Admin Menu Management</title>
  <script src="https://cdn.tailwindcss.com"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }
  body {
    background-color: #f3f4f6;
  }
</style>

</head>
<body class="font-sans">
<header class="bg-white shadow-sm border-b-2 border-indigo-600 sticky top-0">
    <div class="max-w-6xl mx-auto px-6 py-4 flex justify-between items-center">
      <div class="flex items-center gap-2">
        <i class="fas fa-utensils text-2xl text-indigo-600"></i>
        <h1 class="text-2xl font-bold text-gray-800">Menu Management</h1>
      </div>
      <a href="/Employee/admin_main.html" class="bg-gray-600 text-white px-4 py-2 rounded-lg font-semibold hover:bg-gray-700 transition flex items-center gap-2">
        <i class="fas fa-arrow-left"></i>Back
      </a>
    </div>
  </header>

<main class="max-w-6xl mx-auto px-6 py-8">

    <!-- Add new menu item -->
<!-- Add new menu item -->
    <section class="mb-8">
      <h2 class="text-2xl font-bold text-gray-800 mb-4">Add New Menu Item</h2>
      <form id="addForm" class="bg-white rounded-lg shadow-md p-6 border-l-4 border-green-500" enctype="multipart/form-data">
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
          
          <input type="text" id="item_name" name="item_name" placeholder="Item name" required 
            class="border border-gray-300 p-3 rounded-lg focus:outline-none focus:border-green-500 transition">
          
          <!-- Category Dropdown -->
          <select id="category" name="category" class="border border-gray-300 p-3 rounded-lg focus:outline-none focus:border-green-500 transition">
            <!-- Filled by JS -->
          </select>

          <input type="number" id="price" name="price" placeholder="Price ($)" step="0.01" required 
            class="border border-gray-300 p-3 rounded-lg focus:outline-none focus:border-green-500 transition">
          
          <input type="text" id="description" name="description" placeholder="Description" 
            class="border border-gray-300 p-3 rounded-lg focus:outline-none focus:border-green-500 transition sm:col-span-2">
          
          <input type="file" id="image" name="image" accept="image/*" required 
            class="border border-gray-300 p-3 rounded-lg focus:outline-none focus:border-green-500 transition sm:col-span-2">
          
          <button type="submit" class="bg-green-600 text-white px-4 py-3 rounded-lg font-semibold hover:bg-green-700 transition sm:col-span-2">
            <i class="fas fa-plus mr-2"></i>Add Item
          </button>
        </div>
      </form>
    </section>

<!-- Current Menu -->
    <section>
      <h2 class="text-2xl font-bold text-gray-800 mb-6">Current Menu</h2>
      <div id="menuList" class="space-y-10"></div>
    </section>
<script>
let defaultCategories = [
  "Appetizers",
  "Main Courses",
  "Sides",
  "Beverages",
"Desserts"
];

let categorySelect = null;

document.addEventListener("DOMContentLoaded", () => {
  categorySelect = document.getElementById("category");
 loadCategoryDropdown();
setupAddForm();
loadMenu();
});

async function loadCategoryDropdown() {
  if (!categorySelect) return;

  categorySelect.innerHTML = "";

  defaultCategories.forEach(cat => {
    const opt = document.createElement("option");
    opt.value = cat;
    opt.textContent = cat;
    categorySelect.appendChild(opt);
  });
}

    async function loadMenu() {
      const res = await fetch('/Employee/menu');
      const data = await res.json();
      const list = document.getElementById('menuList');
      list.innerHTML = '';
      if (!data.success || !data.items.length) {
        list.innerHTML = '<p class="text-gray-500">No menu items found.</p>';
        return;
      }

      // Group items by category
      const groups = {};
      data.items.forEach(item => {
        const cat = item.category || "Other";
        if (!groups[cat]) groups[cat] = [];
        groups[cat].push(item);
      });

      const sortedCategories = Object.keys(groups).sort();

      sortedCategories.forEach(cat => {
        const section = document.createElement("section");



  const cards = groups[cat].map(item => {
    const badgeColor = item.available ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800';
    const badgeText = item.available ? 'Available' : 'Hidden';
    const imagePath = item.image || '/image/no_image.png';

return `
  <div class="bg-white border border-gray-300 rounded-lg overflow-hidden shadow-md hover:shadow-lg transition flex flex-col">
    <img src="${imagePath}" class="w-full h-48 object-cover bg-gray-200">

    <div class="p-5 flex flex-col flex-grow">
      <div class="flex justify-between items-start mb-2">
        <h3 class="font-bold text-gray-900 text-lg">${item.item_name}</h3>
        <span class="px-2 py-1 text-xs font-semibold rounded-full ${badgeColor}">${badgeText}</span>
      </div>

      <p class="text-sm text-gray-600 flex-grow mb-3">${item.description || 'No description'}</p>

      <p class="font-bold text-green-600 text-lg mb-4">
        $${parseFloat(item.price).toFixed(2)}
      </p>

      <div class="mt-auto flex gap-2">
        <button onclick="toggleItem(${item.item_id}, ${item.available ? 0 : 1})"
            class="flex-1 bg-yellow-500 text-white px-3 py-2 rounded-lg font-semibold hover:bg-yellow-600 transition text-sm">
          ${item.available ? 'Hide' : 'Show'}
        </button>

        <button
          class="flex-1 bg-blue-600 text-white px-3 py-2 rounded-lg font-semibold hover:bg-blue-700 transition text-sm"
          data-edit-item
          data-id="${item.item_id}"
          data-name="${item.item_name}"
          data-description="${item.description || ''}"
          data-price="${item.price}">
          Edit
        </button>

        <button onclick="deleteItem(${item.item_id})"
            class="flex-1 bg-red-500 text-white px-3 py-2 rounded-lg font-semibold hover:bg-red-600 transition text-sm">
          Delete
        </button>
      </div>
    </div>
  </div>
`;

  }).join("");

section.innerHTML = `
    <div class="mb-10">
      <h3 class="text-xl font-bold text-gray-800 mb-4 pb-2 border-b-2 border-indigo-600">${cat}</h3>
      <div class="grid gap-6 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4">
        ${cards}
      </div>
    </div>
  `;

  list.appendChild(section);
});
}



    async function toggleItem(id, available) {
      const res = await fetch('/Employee/menu/' + id, {
        method: 'PUT',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ available })
      });
      const result = await res.json();
      if (result.success) loadMenu();
      else alert(result.message || 'Toggle failed.');
    }

    async function deleteItem(id) {
      if (!confirm('Are you sure you want to delete this item?')) return;
      const res = await fetch('/Employee/menu/' + id, { method: 'DELETE' });
      const result = await res.json();
      if (result.success) loadMenu();
      else alert(result.message || 'Delete failed.');
    }

function setupAddForm() {
  const form = document.getElementById("addForm");
  form.addEventListener("submit", async (e) => {
    e.preventDefault();
    const formData = new FormData(form);

    const res = await fetch('/Employee/menu', {
      method: 'POST',
      body: formData
    });

    const result = await res.json();
    if (result.success) {
      form.reset();
      loadMenu();
      loadCategoryDropdown();
    } else {
      alert(result.message);
    }
  });
}
// Edit item (name, description, price) â€” open modal instead of prompt
document.addEventListener("click", (e) => {
  const btn = e.target.closest("[data-edit-item]");
  if (!btn) return;

  const id = btn.dataset.id;
  const name = btn.dataset.name || "";
  const desc = btn.dataset.description || "";
  const price = btn.dataset.price || "";

  openEditModal(id, name, desc, price);
});


// edit modal logic

let editItemId = null;

function openEditModal(id, name, description, price) {
  editItemId = id;

  document.getElementById("editName").value = name;
  document.getElementById("editDescription").value = description;
  document.getElementById("editPrice").value = price;

  document.getElementById("editModalOverlay").classList.remove("hidden");
  document.getElementById("editModal").classList.remove("hidden");
}

function closeEditModal() {
  document.getElementById("editModalOverlay").classList.add("hidden");
  document.getElementById("editModal").classList.add("hidden");
}

async function submitEdit() {
  const updatedItem = {
    item_name: document.getElementById("editName").value.trim(),
    description: document.getElementById("editDescription").value.trim(),
    price: document.getElementById("editPrice").value.trim()
  };

  const res = await fetch(`/Employee/menu/${editItemId}/edit`, {
    method: "PUT",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(updatedItem)
  });

  const result = await res.json();

  if (result.success) {
    closeEditModal();
    loadMenu();
    alert("Item updated successfully!");
  } else {
    alert(result.message || "Update failed.");
  }
}


</script>

<!-- EDIT MODAL -->
<div id="editModalOverlay" class="hidden fixed inset-0 bg-black/30 z-40"></div>

<div id="editModal" class="hidden fixed inset-0 z-50 flex items-center justify-center p-4">
  <div class="bg-white w-full max-w-md rounded-lg shadow-lg p-6 border-l-4 border-blue-500">

    <h2 class="text-xl font-bold text-gray-800 mb-5">Edit Menu Item</h2>

    <label class="block mb-2 text-sm font-semibold text-gray-700">Item Name</label>
    <input id="editName" class="w-full border border-gray-300 p-3 rounded-lg focus:outline-none focus:border-blue-500 transition mb-4" type="text">

    <label class="block mb-2 text-sm font-semibold text-gray-700">Description</label>
    <textarea id="editDescription" class="w-full border border-gray-300 p-3 rounded-lg focus:outline-none focus:border-blue-500 transition mb-4 resize-none h-24"></textarea>

    <label class="block mb-2 text-sm font-semibold text-gray-700">Price ($)</label>
    <input id="editPrice" class="w-full border border-gray-300 p-3 rounded-lg focus:outline-none focus:border-blue-500 transition mb-6" type="number" step="0.01">

    <div class="flex justify-end gap-3">
      <button onclick="closeEditModal()" 
              class="px-4 py-2 bg-gray-300 text-gray-800 rounded-lg font-semibold hover:bg-gray-400 transition">
        Cancel
      </button>

      <button onclick="submitEdit()" 
              class="px-4 py-2 bg-blue-600 text-white rounded-lg font-semibold hover:bg-blue-700 transition">
        Save Changes
      </button>
    </div>

  </div>
</div>

</body>
</html>
